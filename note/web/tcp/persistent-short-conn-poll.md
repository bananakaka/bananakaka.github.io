#### http长连接是什么？

首先更正一个说法：http协议没有长连接、短连接的概念。http协议是基于请求/响应模式的，因此只要服务端给了响应，本次http连接就结束了。其实长连接本质上是说的tcp连接，tcp连接是一个双向的通道，它是可以保持一段时间不关闭的。http请求和http响应，都是通过tcp连接这个通道来回传输的。http协议说到底是应用层的协议，而tcp才是真正的传输层协议，只有负责传输的这一层才需要建立连接。
注：网络层使用IP协议。IP协议主要解决网络路由和寻址问题，TCP协议主要解决如何在IP层之上可靠的传递数据包，使在网络上的另一端收到发端发出的所有包，并且顺序与发出顺序一致。

#### 使用长连接有什么好处？

因为长连接情况下，多个http请求可以复用同一个tcp连接，避免每发出一个http请求，就创建一个tcp连接，从而节省了很多tcp连接建立(3次握手)和释放(4次握手)的资源消耗、时间消耗。比如打开一个页面，页面里肯定包含css、js、图片等一系列静态资源，这么多次http请求，其实使用的都是同一个tcp连接，很显然节省很多消耗的。

#### 是不是只要设置Connection为keep-alive就算是长连接了？

当然是的，但要客户端的request和服务端response都设置：Connection:keep-alive。

#### 我们平时用的是不是长连接？

当然是的。现在用的基本上都是HTTP1.1协议，而且HTTP协议文档上也提到了，HTTP1.1默认是Connection=keep-alive，多个HTTP请求可以复用同一个TCP连接。

#### 使用长连接，客户端、服务端怎么知道本次传输结束呢？

a.判断传输数据是否达到了Content-Length大小。
b.动态生成的文件没有Content-Length，它是分块传输（chunked），这时候就要根据chunked编码来判断，chunked编码的数据在最后有一个空chunked块，表明本次传输数据结束。

#### 长连接是不是永久连接的？

并不是，如果一段时间内，这个tcp连接没有http请求的话，这个长连接会被断开。具体时间长短，可以在header中设置，这个时间叫超时时间。

#### 既然HTTP1.1默认打开长连接，那如何关闭？

客户端的request中添加：Connection:close。

#### tcp长连接的保活功能

主要为服务端应用提供，如果客户端已经消失，此时连接未断开，则会使得服务器上保留一个半开放的连接，此时服务端将永远等待客户端的数据，保活功能就是试图在服务端检测到这种半开放的连接。

#### tcp长连接和短连接的优缺点？

长连接优点：上面已经描述很详细，省去较多的tcp连接和释放的操作，节约资源，节约时间。适合客户端频繁访问的场景。
长连接缺点：随着客户端越来越多，服务端保持着多个连接，服务端需要采取释放连接策略，如释放长时间没有发请求的连接，或者限制每个客户端的最大连接数。
短连接优点：对服务端管理较为简单，存在的都是有用的连接，不用额外控制手段。
短连接缺点：客户端访问频繁的场景，将在tcp的建立和释放连接上浪费较多的时间和带宽。



#### 什么是短轮询？

写个死循环，不停地请求，每次请求不管有没有变化服务端都会立即返回结果

#### 什么是长轮询？

服务器根据业务逻辑发现返回结果和上一次没变化，就会把当前请求挂起一段时间(这个时间也叫超时时间，一般是几十秒)，这个时间里，检测到变化就立即返回，否则一直等到超时为止。

#### 怎么实现的长轮询？

在服务端通过编程的方式手动挂起请求来实现的。

#### 长轮询的优缺点？

优点：客户端的请求次数将会大量减少，节省了客户端和服务端的流量，减少了服务端的压力。
缺点：请求挂起同样会导致资源浪费，每一个挂起的请求，服务端这边就会挂着一个线程，在不停的检测数据是否变化，依然会有性能问题。

结论：不管是长轮询还是短轮询，都不太适用于客户端数量太多的情况，因为每个服务器所能承载的TCP连接数是有上限的，这种轮询很容易把tcp连接数顶满。

