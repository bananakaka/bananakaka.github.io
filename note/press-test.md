为什么要在线上做压测？
数据量
机器配置

应急处理

达到指定容量时，验证告警

单服务压测，用线上真实流量验证，逐步加大流量
单服务--http
灰度集群线上引流，逐步加大流量

单服务--thrift
服务分组，逐步停用服务节点

单服务
适用场景：流量可以实时调度，业务系统实时监控，不做系统整体容量评估。
优点：真实的线上流量，不用做流量隔离，不用数据清理，对下游无害，无需额外工具支持。
缺点：假设别人都ok的情况下，不能反映真实线上情况，反映不了系统整体容量。
需要的支持：RPC框架支持流量调度功能。
服务提供方自己执行

之所以需要2倍容量，避免流量逐渐变多，或其他平台down掉，流量激增。

全链路压测
为什么要做全链路？
业务流量增长迅速，低峰期无流量验证、发版后要用第二天的高峰期来验证，出故障损失大、

制定压测计划
先制定目标
    整体目标：整个系统达到一天可处理多少订单，降级机制，系统处理能力，验证主流程的性能、容量
    拆解目标：请求qps，每个机房分别承担多少qps
制定具体压测方案：
    数据构造：nginx日志录制、写请求模拟。
    流量隔离：请求参数打标，统计数据丢弃。电话/短信服务按测试门店过滤。支付mock，配送mock。
预压测：验证配置、脚本都准确
周知
正式压测
    监控、ptest
    异步阶梯式压测，探测系统瓶颈
数据清理
    清理线上订单数据
    下线门店
压测总结
适用场景：整体容量验证、性能瓶颈排查、监控告警有效性、告警阈值设置、行动警戒线设置。
优点：贯穿了整个业务系统、发现系统的瓶颈及容量。
缺点：可能影响用户，需要联合的角色较多，成本高。
架构、QA、业务联合执行
